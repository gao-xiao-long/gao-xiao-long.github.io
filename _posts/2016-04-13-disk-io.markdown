---
layout: post
title: 为什么磁盘顺序读写比随机读写更快
date: 2016-4-13
author: "gao-xiao-long"
catalog: true
tags:
    - 磁盘IO
---

传统磁盘是由**盘片**构成，每个盘片表面都覆盖着磁性记录材料。盘片中央有一个可以旋转的**主轴**，它使得盘片以固定的旋转速率(rotational rate)旋转，通常是5400 ~ 15000转每分钟(Revolution Per Minute, **RPM**)。磁盘通常包含一个或者多个这样的盘片，并封装在一个密封容器内。每个盘片表面是由一组成为**磁道(track)**的同心圆组成。每个磁道被划分为一组**扇区(sector)**, 每个扇区包含相等数量的数据位(通常是512字节)，数据编码在扇区上的磁性材料中。扇区之间由由一些间隙(gap)隔开。磁盘用读/写头(read/write head)来读写存储在磁性表面的位，读/写头连接到一个传动臂(actuator arm)一端，通过移动传动臂，驱动器可以将读写头定位在盘面上的任何磁道上，这样的机械运动成为**寻道(seek)**。下图可以对磁盘结构有个直观的理解:
![整体结构图](/img/in-post/disk0.png)
![磁道与扇区](/img/in-post/disk1.png)
![磁头寻道示意图](/img/in-post/disk2.png)
![现实中的磁盘](/img/in-post/disk3.png)

磁盘以扇区大小的块来读写数据。对扇区的访问时间，有三个主要部分:  **寻道时间、旋转时间和传送时间**:
- **寻道时间**: 为了读取某个目标扇区的内容，传动臂首先将读/写头定位到包含目标扇区的磁道上。移动传动臂所需的时间为寻道时间。寻道时间依赖于读/写头以前的位置和传动臂在盘面上移动的速度。通常一次寻道时间平均为3~9ms。最大时间可以达到20ms。
- **旋转时间**: 一旦读/写头定位到了期望的磁道，驱动器等待目标扇区的第一位旋转到读写头下，这个步骤的性能依赖于当读写头到达目标扇区时盘面的位置和磁盘的旋转速度。通常使用磁盘旋转一周所需时间的1/2表示，在最坏的情况下，读写头刚刚错过了目标扇区，必须等待磁盘转一圈。7200 rpm的磁盘平均旋转延迟大约为4.17ms，而转速为15000 rpm的磁盘其平均旋转延迟为2ms。
- **传送时间**: 当目标扇区的第一位位于读/写头下时，驱动器就可以开始读或者写该扇区的内容了，一个扇区的传送时间依赖于旋转速度和每条磁道的扇区数目，简单计算时可忽略。

**在顺序读写的时候，寻道和旋转步骤只需要执行一次，剩下的全是数据传输所需要的固有开销；而每次随机读写的时候，寻道和旋转步骤都需要执行，所以，机顺序读写比随机读写更快**
在多线程并发读写磁盘的情况下，磁盘I/O效率将大大下降，可以 减少多进程或者多线程对磁盘的并发读写，比如日志打印程序，可以使用专门磁盘I/O线程来对磁盘读写。
需要说明的是，与传统的磁盘相比，固态磁盘(SSD)并没有机械装置，也就没有了传统磁盘的寻道时间和旋转时间，所以SSD也可以提供非常高的随机读取能力(但是它随机写性能则比随机读慢一个数量级)。

**其他相关文章**

[磁盘性能指标--IOPS 理论](http://elf8848.iteye.com/blog/1731274)

[淘宝海量数据库之八-攻克随机IO难关](http://blog.sina.com.cn/s/blog_3fc85e260100qwv8.html)

[数据库如何抵抗随机IO：问题、方法与现实](http://wangyuanzju.blog.163.com/blog/static/13029201132154010987)

[提升磁盘io性能的几个技巧](http://www.searchtb.com/2011/05/%E6%8F%90%E5%8D%87%E7%A3%81%E7%9B%98io%E6%80%A7%E8%83%BD%E7%9A%84%E5%87%A0%E4%B8%AA%E6%8A%80%E5%B7%A7.html)


